<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <link rel="stylesheet" href="../CSS/login.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="../JS/profile.js" defer></script>

</head>

<body>
    <div class="login-container">
        <div class="login-form">
            <h1>Login</h1>
            <p id="msg-form"></p>
            <form action="#" id="form">
                <div class="box-form">
                    <input placeholder="Email" type="text" name="email" required>
                    <i class='bx bxs-user'></i>
                </div>

                <div class="box-form">
                    <input placeholder="Senha" type="password" name="senha" required>
                    <i class='bx bxs-lock-alt'></i>
                </div>

                <div class="box-remember">
                    <label>
                        <input type="checkbox" name="lembrar" id="remeber">
                        Lembrar
                    </label>
                    <a href="#">Esqueceu a senha?</a>
                </div>

                <button type="submit">Entrar</button>

                <div class="registro">
                    <p>Não tem uma conta? <a href="register.html">Registrar</a> </p>
                </div>
            </form>
        </div>
    </div>
    <script>
        const form = document.querySelector('#form');
        const msg = document.getElementById('msg-form')

        form.addEventListener('submit', async (e) => {
            msg.style.display = 'none'
            e.preventDefault(); // Impede a página de recarregar

            const userData = {
                email: form.email.value,
                senha: form.senha.value,
            }


            const response = await fetch('/auth/logar', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userData) // Transforma o objeto em texto JSON
            });
            if (!response) {
                return console.log('Deu erro!')
            }
            const data = await response.json()

            if (data.content == 'Senha inválida') {
                msg.style.display = "block"
                msg.innerText = "Senha Incorreta"
            }
            if (data.content == "Conta inexistente") {
                msg.style.display = "block"
                msg.innerText = "Esse Email não existe"
            }

            // No momento do sucesso do login:
            if (data.success) {
                const storage = form.lembrar.checked ? localStorage : sessionStorage;

                storage.setItem("token", data.token);
                storage.setItem("playerProfile", JSON.stringify(data.user));

                setInterval(() => {
                    window.location.href = "perfil.html"
                }, 2000);
            }
        })


    </script>
</body>

</html>